<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MoonPacks</title>
<style>
body { font-family: Arial, sans-serif; background: #f9fafb; color: #111827; margin:0; padding:0; }
header { background: linear-gradient(90deg,#6366f1,#8b5cf6,#ec4899); color:white; padding:20px; border-radius:0 0 20px 20px; text-align:center; position:relative; }
.menu-button { position:absolute; top:15px; right:15px; cursor:pointer; font-size:24px; }
.menu-dropdown { display:none; position:absolute; top:50px; right:15px; background:white; border:1px solid #ccc; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.1); z-index:100; }
.menu-dropdown button { display:block; width:100%; padding:10px; background:none; border:none; text-align:left; cursor:pointer; }
.menu-dropdown button:hover { background:#f3f4f6; }
.container { max-width:1200px; margin:20px auto; padding:10px; display:grid; grid-template-columns:2fr 1fr; gap:20px; }
.products, .cart, .admin-panel { background:white; padding:15px; border-radius:15px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
.products-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:15px; }
.product { border:1px solid #e5e7eb; border-radius:10px; text-align:center; padding:10px; transition:0.2s; cursor:pointer; background:#fff; }
.product:hover { background:#f3f4f6; }
.product img { width:60px; height:60px; margin-bottom:5px; }
.cart-item { display:flex; justify-content:space-between; align-items:center; padding:8px 0; border-bottom:1px solid #e5e7eb; }
.cart-item button { padding:4px 8px; margin:0 3px; border-radius:5px; border:1px solid #ccc; background:#f3f4f6; cursor:pointer; }
.cart-item button:hover { background:#e0e0e0; }
.totals { margin-top:15px; font-size:14px; }
.totals div { display:flex; justify-content:space-between; margin:3px 0; }
.actions { margin-top:15px; display:flex; gap:10px; }
.btn { flex:1; padding:10px; border:none; border-radius:8px; background:#6366f1; color:white; cursor:pointer; font-size:14px; transition:0.2s; }
.btn:hover { background:#4f46e5; }
.modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:none; justify-content:center; align-items:center; }
.modal.active { display:flex; }
.modal-content { background:white; padding:20px; border-radius:10px; width:300px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.15); }
.close { cursor:pointer; float:right; font-size:18px; }
.admin-panel { display:none; margin:20px auto; }
.admin-section { margin-bottom:25px; background:#f9fafb; padding:15px; border-radius:10px; box-shadow:inset 0 1px 3px rgba(0,0,0,0.05); }
.terminal-output { background:#111827; color:#f3f4f6; padding:10px; border-radius:8px; font-family:monospace; height:150px; overflow-y:auto; margin-bottom:10px; }
.terminal-input { width:100%; padding:10px; font-family:monospace; border-radius:5px; border:1px solid #ccc; }
.tab-list { display:flex; gap:5px; margin-bottom:10px; flex-wrap:wrap; }
.tab-list button { padding:6px 10px; border:1px solid #ccc; border-radius:5px; background:#f3f4f6; cursor:pointer; }
.tab-list button.active { background:#6366f1; color:white; }
.tab-content { border:1px solid #e5e7eb; border-radius:8px; padding:10px; min-height:100px; background:#fff; }
input, textarea { width:100%; padding:8px; margin:5px 0; border-radius:5px; border:1px solid #ccc; }
#admin-login-btn { position:fixed; bottom:20px; left:20px; padding:10px 15px; background:#6366f1; color:white; border:none; border-radius:8px; cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,0.2); z-index:1000; }
#admin-login-btn:hover { background:#4f46e5; }
#public-id-section { margin:20px; padding:10px; background:#fff; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
</style>
</head>
<body>
<header>
<h1>MoonPacks</h1>
<p>Najlepsi na rynku! dc.gg/moonpacks</p>
<div class="menu-button" onclick="toggleMenu()">⋮</div>
<div class="menu-dropdown" id="menu-dropdown">
<button id="menu-admin-login">Logowanie administratora</button>
</div>
</header>

<!-- Publiczne ustawianie ID -->
<div id="public-id-section">
<h3>Ustaw swoje ID (tylko raz)</h3>
<input type="text" id="public-user-id" placeholder="Wpisz ID">
<button class="btn" onclick="setPublicUserId()">Ustaw ID</button>
<p id="public-id-status"></p>
</div>

<div class="container" id="shop-container">
<div class="products">
<h2>Produkty</h2>
<div class="products-grid" id="products-grid"></div>
</div>
<div class="cart">
<h2>Koszyk</h2>
<div id="cart-items"></div>
<div class="totals">
<div><span>Netto:</span><span id="netto">0,00 zł</span></div>
<div><span>VAT:</span><span id="vat">0,00 zł</span></div>
<div><span>Rabat:</span><span id="discount">0,00 zł</span></div>
<div style="font-weight:bold;border-top:1px solid #ccc;margin-top:5px;padding-top:5px;"><span>Suma:</span><span id="total">0,00 zł</span></div>
</div>
<div class="actions">
<button class="btn" onclick="selectPaymentMethod('cash')">Gotówka</button>
<button class="btn" onclick="selectPaymentMethod('card')">Karta</button>
<button class="btn" onclick="selectPaymentMethod('blik')">BLIK</button>
</div>
</div>
</div>

<!-- Panel administratora -->
<div class="admin-panel" id="admin-panel">
<h2>Panel Administratora</h2>

<div class="admin-section">
<h3>Produkty</h3>
<input type="text" id="new-product-name" placeholder="Nazwa produktu">
<input type="number" id="new-product-price" placeholder="Cena">
<input type="text" id="new-product-img" placeholder="URL grafiki">
<button class="btn" onclick="addProduct()">Dodaj produkt</button>
<ul id="product-list"></ul>
</div>

<div class="admin-section">
<h3>Nadawanie uprawnień użytkownikowi</h3>
<input type="text" id="user-id-input" placeholder="ID użytkownika">
<input type="text" id="perm-input" placeholder="Uprawnienie">
<button class="btn" onclick="setPermission()">Nadaj uprawnienie</button>
<ul id="permission-list"></ul>
</div>

<div class="admin-section">
<h3>Nadawanie rabatu lub kasy</h3>
<input type="text" id="target-user-id" placeholder="ID użytkownika">
<input type="number" id="cash-amount" placeholder="Kwota">
<button class="btn" onclick="giveCash()">Nadaj kasę</button>
<input type="number" id="discount-amount" placeholder="Rabat %">
<button class="btn" onclick="giveDiscount()">Nadaj rabat</button>
</div>

<div class="admin-section">
<h3>Zakładki panelu</h3>
<div class="tab-list" id="tab-list"></div>
<div class="tab-content" id="tab-content">Wybierz zakładkę lub dodaj nową.</div>
<input type="text" id="new-tab-title" placeholder="Tytuł zakładki">
<textarea id="new-tab-content" placeholder="Treść / HTML" rows="3"></textarea>
<button class="btn" onclick="addTab()">Dodaj zakładkę</button>
</div>

<div class="admin-section">
<h3>Terminal komend</h3>
<div class="terminal-output" id="terminal-output"></div>
<input class="terminal-input" id="terminal-input" placeholder="Wpisz komendę..." onkeydown="handleCommand(event)">
</div>

<button class="btn" onclick="logout()">Wyloguj</button>
</div>

<!-- Modal płatności -->
<div class="modal" id="payment-modal">
<div class="modal-content">
<span class="close" onclick="closeModal()">&times;</span>
<h3>Wybór płatności</h3>
<p>Kwota do zapłaty: <span id="pay-amount">0,00 zł</span></p>
<button class="btn" onclick="confirmPayment()">Potwierdź</button>
</div>
</div>

<!-- Przycisk logowania admin -->
<button id="admin-login-btn">Logowanie Admin</button>

<script>
// MENU
function toggleMenu(){
  const menu=document.getElementById('menu-dropdown');
  menu.style.display = menu.style.display==='block'?'none':'block';
}

// PRODUCTS
let products = [
{id:'p1',name:'Espresso',price:8.5,vat:0.08,img:'https://via.placeholder.com/60'},
{id:'p2',name:'Latte',price:12.0,vat:0.08,img:'https://via.placeholder.com/60'},
{id:'p3',name:'Kanapka club',price:18.0,vat:0.08,img:'https://via.placeholder.com/60'}
];
let cart=[];

function renderProducts(){
  const grid=document.getElementById('products-grid');
  grid.innerHTML='';
  products.forEach(p=>{
    const div=document.createElement('div');
    div.className='product';
    div.innerHTML=`<img src="${p.img}" alt="${p.name}"><h4>${p.name}</h4><p>${p.price.toFixed(2)} zł</p>`;
    div.onclick=()=>addToCart(p);
    grid.appendChild(div);
  });
}
function addToCart(product){
  const existing=cart.find(i=>i.id===product.id);
  if(existing){existing.qty++;}else{cart.push({...product,qty:1});}
  renderCart();
}
function changeQty(id,delta){
  const item=cart.find(i=>i.id===id);
  if(!item) return;
  item.qty+=delta;
  if(item.qty<=0){cart.splice(cart.indexOf(item),1);}
  renderCart();
}
function renderCart(){
  const container=document.getElementById('cart-items');
  container.innerHTML='';
  let netto=0,vat=0;
  cart.forEach(i=>{
    netto+=i.price*i.qty;
    vat+=(i.price*i.vat)*i.qty;
    const div=document.createElement('div');
    div.className='cart-item';
    div.innerHTML=`<span>${i.name}</span><div><button onclick="changeQty('${i.id}',-1)">-</button>${i.qty}<button onclick="changeQty('${i.id}',1)">+</button><strong>${(i.price*i.qty).toFixed(2)} zł</strong></div>`;
    container.appendChild(div);
  });
  document.getElementById('netto').textContent=netto.toFixed(2)+' zł';
  document.getElementById('vat').textContent=vat.toFixed(2)+' zł';
  document.getElementById('discount').textContent='0,00 zł';
  document.getElementById('total').textContent=(netto+vat).toFixed(2)+' zł';
}

// PAYMENT
let currentPaymentMethod='';
function selectPaymentMethod(method){
  currentPaymentMethod=method;
  document.getElementById('payment-modal').classList.add('active');
  document.getElementById('pay-amount').textContent=document.getElementById('total').textContent;
}
function closeModal(){document.getElementById('payment-modal').classList.remove('active');}
function confirmPayment(){
  closeModal();
  alert('Transakcja zakończona metodą: '+currentPaymentMethod);
  cart.length=0;
  renderCart();
}

// ADMIN LOGIN
function showLogin(){
  const login=prompt('Login:');
  const pass=prompt('Hasło:');
  if(login==='adminaccount51' && pass==='w2r3g6'){
    document.getElementById('shop-container').style.display='none';
    document.getElementById('admin-panel').style.display='block';
    loadPermissions();
    loadTabs();
    loadProductsAdmin();
  } else alert('Błędne dane logowania');
}
function logout(){
  document.getElementById('shop-container').style.display='grid';
  document.getElementById('admin-panel').style.display='none';
}

// ADMIN BUTTONS
document.getElementById('admin-login-btn').onclick = showLogin;
document.getElementById('menu-admin-login').onclick = showLogin;

// PUBLIC ID
function loadPublicIdStatus(){
  const savedId = localStorage.getItem('userId');
  if(savedId){
    document.getElementById('public-id-status').textContent = `Twój ID już ustawione: ${savedId}`;
    document.getElementById('public-user-id').disabled = true;
  }
}
function setPublicUserId(){
  const input = document.getElementById('public-user-id');
  const status = document.getElementById('public-id-status');
  let savedId = localStorage.getItem('userId');
  if(savedId){
    status.textContent = `Twój ID już ustawione: ${savedId}`;
    return;
  }
  const id = input.value.trim();
  if(!id) return alert('Podaj ID');
  localStorage.setItem('userId', id);
  status.textContent = `Twój ID ustawione: ${id}`;
  input.disabled = true;
}

// PERMISSIONS
function loadPermissions(){
  const permissions=JSON.parse(localStorage.getItem('permissions')||'{}');
  const list=document.getElementById('permission-list');
  list.innerHTML='';
  for(let userId in permissions){
    const li=document.createElement('li');
    li.textContent=`${userId}: ${permissions[userId].join(', ')}`;
    list.appendChild(li);
  }
}
function setPermission(){
  const userId=document.getElementById('user-id-input').value;
  const perm=document.getElementById('perm-input').value;
  if(!userId||!perm) return alert('Podaj ID użytkownika i uprawnienie');
  const permissions=JSON.parse(localStorage.getItem('permissions')||'{}');
  if(!permissions[userId]) permissions[userId]=[];
  if(!permissions[userId].includes(perm)) permissions[userId].push(perm);
  localStorage.setItem('permissions',JSON.stringify(permissions));
  loadPermissions();
}

// CASH & DISCOUNT
function giveCash(){
  const userId=document.getElementById('target-user-id').value;
  const amount=parseFloat(document.getElementById('cash-amount').value);
  if(!userId||isNaN(amount)) return alert('Podaj ID użytkownika i kwotę');
  alert(`Dodano ${amount} zł dla użytkownika: ${userId}`);
}
function giveDiscount(){
  const userId=document.getElementById('target-user-id').value;
  const discount=parseFloat(document.getElementById('discount-amount').value);
  if(!userId||isNaN(discount)) return alert('Podaj ID użytkownika i rabat');
  alert(`Dodano rabat ${discount}% dla użytkownika: ${userId}`);
}

// TERMINAL
function handleCommand(event){
  if(event.key==='Enter'){
    const input=document.getElementById('terminal-input');
    const command=input.value.trim();
    executeCommand(command);
    input.value='';
  }
}
function logTerminal(msg){
  const output=document.getElementById('terminal-output');
  output.innerHTML+=msg+'\n';
  output.scrollTop=output.scrollHeight;
}
function executeCommand(cmd){
  const parts=cmd.split(' ');
  const action=parts[0];
  const userId=parts[1];
  const value=parts[2];
  const permissions=JSON.parse(localStorage.getItem('permissions')||'{}');
  switch(action){
    case 'setPermission':
      if(!permissions[userId]) permissions[userId]=[];
      if(!permissions[userId].includes(value)) permissions[userId].push(value);
      localStorage.setItem('permissions',JSON.stringify(permissions));
      loadPermissions();
      logTerminal(`Dodano uprawnienie ${value} dla ${userId}`);
      break;
    case 'revokePermission':
      if(permissions[userId]){
        permissions[userId]=permissions[userId].filter(p=>p!==value);
        localStorage.setItem('permissions',JSON.stringify(permissions));
        loadPermissions();
        logTerminal(`Usunięto uprawnienie ${value} dla ${userId}`);
      }
      break;
    case 'giveCash':
      logTerminal(`Dodano ${value} zł dla ${userId}`);
      break;
    case 'giveDiscount':
      logTerminal(`Dodano rabat ${value}% dla ${userId}`);
      break;
    default:
      logTerminal('Nieznana komenda');
  }
}

// TABS
let tabs=[];
function loadTabs(){
  const saved=JSON.parse(localStorage.getItem('tabs')||'[]');
  tabs=saved;
  renderTabButtons();
}
function renderTabButtons(){
  const list=document.getElementById('tab-list');
  list.innerHTML='';
  tabs.forEach((t,i)=>{
    const btn=document.createElement('button');
    btn.textContent=t.title;
    btn.className=i===0?'active':'';
    btn.onclick=()=>selectTab(i);
    list.appendChild(btn);
  });
  if(tabs.length>0) document.getElementById('tab-content').innerHTML=tabs[0].content;
}
function selectTab(index){
  const content=document.getElementById('tab-content');
  content.innerHTML=tabs[index].content;
  const btns=document.getElementById('tab-list').children;
  for(let i=0;i<btns.length;i++) btns[i].className=i===index?'active':'';
}
function addTab(){
  const title=document.getElementById('new-tab-title').value.trim();
  const content=document.getElementById('new-tab-content').value.trim();
  if(!title||!content) return alert('Podaj tytuł i treść zakładki');
  tabs.push({title,content});
  localStorage.setItem('tabs',JSON.stringify(tabs));
  renderTabButtons();
  document.getElementById('new-tab-title').value='';
  document.getElementById('new-tab-content').value='';
}

// PRODUCTS ADMIN
function loadProductsAdmin(){
  const list=document.getElementById('product-list');
  list.innerHTML='';
  products.forEach((p,i)=>{
    const li=document.createElement('li');
    li.innerHTML=`${p.name} - ${p.price.toFixed(2)} zł <button onclick="removeProduct(${i})">Usuń</button>`;
    list.appendChild(li);
  });
}
function addProduct(){
  const name=document.getElementById('new-product-name').value.trim();
  const price=parseFloat(document.getElementById('new-product-price').value);
  const img=document.getElementById('new-product-img').value.trim()||'https://via.placeholder.com/60';
  if(!name||isNaN(price)) return alert('Podaj nazwę i cenę produktu');
  products.push({id:'p'+Date.now(),name,price,vat:0.08,img});
  renderProducts();
  loadProductsAdmin();
  document.getElementById('new-product-name').value='';
  document.getElementById('new-product-price').value='';
  document.getElementById('new-product-img').value='';
}
function removeProduct(index){
  products.splice(index,1);
  renderProducts();
  loadProductsAdmin();
}

// INIT
renderProducts();
renderCart();
loadPublicIdStatus();
</script>
</body>
</html>
